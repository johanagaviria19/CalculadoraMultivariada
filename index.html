<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>CalMulti3D</title>
    <link rel="stylesheet" href="styles.css" />
    <!-- Usaremos módulos ES para Three.js y OrbitControls desde main.js -->
    <script src="https://cdn.jsdelivr.net/npm/mathjs@11.11.0/lib/browser/math.js"></script>
    <!-- Renderizado LaTeX para mostrar las funciones como en el ejemplo -->
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" id="MathJax-script" async></script>
  </head>
  <body>
    <div id="app">
      <aside id="sidebar">
        <h1>CalMulti3D</h1>
        <section class="panel">
          <h2>Función</h2>
          <label for="fnSelect">Selecciona una fórmula</label>
          <select id="fnSelect"></select>
          <label for="fnInput">z = f(x, y)</label>
          <input id="fnInput" type="text" placeholder="7*x*y / exp(x^2 + y^2)" />
          <div id="texDisplay" class="tex-display" aria-live="polite"></div>
          <div class="grid">
            <div>
              <label for="viewMode">Vista</label>
              <select id="viewMode">
                <option value="3D" selected>3D</option>
                <option value="2D">2D (curvas de nivel)</option>
              </select>
            </div>
            <div>
              <label for="contourLevels">Curvas</label>
              <input id="contourLevels" type="range" min="5" max="40" step="1" value="12" />
              <span id="contourLevelsLabel">12</span>
            </div>
            <div>
              <label for="contourWidth">Grosor</label>
              <input id="contourWidth" type="range" min="0.5" max="3" step="0.1" value="1" />
              <span id="contourWidthLabel">1.0</span>
            </div>
            <div>
              <label for="contourColor">Color</label>
              <select id="contourColor">
                <option value="red" selected>Rojo</option>
                <option value="blue">Azul</option>
                <option value="green">Verde</option>
              </select>
            </div>
            <div>
              <label for="contourGradient">Degradado</label>
              <input id="contourGradient" type="checkbox" />
            </div>
            <div>
              <label for="useFixedColor">Usar color fijo</label>
              <input id="useFixedColor" type="checkbox" checked />
            </div>
            <div>
              <label for="useCustomWidth">Grosor personalizado</label>
              <input id="useCustomWidth" type="checkbox" checked />
            </div>
          </div>
          <button id="save2DBtn" style="display:none">Guardar imagen 2D</button>
          <div class="row">
            <label for="resolution">Resolución</label>
            <input id="resolution" type="range" min="20" max="150" step="5" value="60" />
            <span id="resolutionLabel">60</span>
          </div>
          <button id="addGraphBtn">Añadir a la gráfica</button>
        </section>

        <section class="panel">
          <h2>Axes</h2>
          <div class="grid">
            <div>
              <label for="xmin">x-min</label>
              <input id="xmin" type="number" step="0.1" value="-3" />
            </div>
            <div>
              <label for="xmax">x-max</label>
              <input id="xmax" type="number" step="0.1" value="3" />
            </div>
            <div>
              <label for="ymin">y-min</label>
              <input id="ymin" type="number" step="0.1" value="-3" />
            </div>
            <div>
              <label for="ymax">y-max</label>
              <input id="ymax" type="number" step="0.1" value="3" />
            </div>
            <div>
              <label for="zmin">z-min</label>
              <input id="zmin" type="number" step="0.1" value="-2" />
            </div>
            <div>
              <label for="zmax">z-max</label>
              <input id="zmax" type="number" step="0.1" value="2" />
            </div>
          </div>
          <div class="grid">
            <div>
              <label for="zclipLow">lower z-clip</label>
              <input id="zclipLow" type="number" step="0.1" placeholder="(opcional)" />
            </div>
            <div>
              <label for="zclipHigh">upper z-clip</label>
              <input id="zclipHigh" type="number" step="0.1" placeholder="(opcional)" />
            </div>
          </div>
          <div class="grid">
            <div>
              <label for="clipToBox">Recortar a caja 3D</label>
              <input id="clipToBox" type="checkbox" />
            </div>
          </div>
          <div class="grid">
            <div>
              <label for="showGrid3D">Mostrar cuadrícula 3D</label>
              <input id="showGrid3D" type="checkbox" checked />
            </div>
            <div>
              <label for="showAxes3D">Mostrar ejes 3D</label>
              <input id="showAxes3D" type="checkbox" checked />
            </div>
          </div>
          <div class="grid">
            <div>
              <label for="autoUpdateGraphs">Actualizar superficies al aplicar límites</label>
              <input id="autoUpdateGraphs" type="checkbox" checked />
            </div>
          </div>
          <button id="applyAxesBtn">Aplicar límites</button>
        </section>

        <section class="panel">
          <h2>Gráficas</h2>
          <ul id="graphsList" class="list"></ul>
          <div class="row">
            <button id="clearAllBtn" class="danger">Limpiar todo</button>
          </div>
        </section>

        <section class="panel">
          <h2>Opciones</h2>
          <div class="row">
            <button id="resetOptionsBtn">Restablecer opciones</button>
          </div>
          <div class="grid">
            <div>
              <label for="zoom3D">Zoom cámara 3D</label>
              <input id="zoom3D" type="range" min="25" max="85" step="1" />
              <span id="zoom3DLabel">45°</span>
            </div>
            <div>
              <button id="fitView3DBtn">Ajustar vista al cubo</button>
            </div>
          </div>
          <div class="grid">
            <div>
              <label for="graphScale3D">Escala de gráfica 3D</label>
              <input id="graphScale3D" type="range" min="0.1" max="2.0" step="0.05" value="1" />
              <span id="graphScale3DLabel">1.00×</span>
            </div>
          </div>
        </section>

        <section class="panel">
          <h2>Cálculos</h2>
          <div class="grid">
            <div>
<<<<<<< HEAD
              <label for="autoPoint">Elegir punto automáticamente</label>
              <input id="autoPoint" type="checkbox" checked />
=======
              <label for="calcX0">x₀</label>
              <input id="calcX0" type="number" step="0.1" value="0" title="Si queda vacío o inválido, se usa el centro de la caja" placeholder="(auto centro)" />
            </div>
            <div>
              <label for="calcY0">y₀</label>
              <input id="calcY0" type="number" step="0.1" value="0" title="Si queda vacío o inválido, se usa el centro de la caja" placeholder="(auto centro)" />
>>>>>>> b84ca4adfcadfa1f0dfa8a8782d467cff94045a1
            </div>
            <div>
              <label for="showGradient">Mostrar gradiente en 2D</label>
              <input id="showGradient" type="checkbox" />
            </div>
            <div>
              <label for="showGradientField2D">Mostrar campo de gradiente en 2D</label>
              <input id="showGradientField2D" type="checkbox" />
            </div>
            <div>
              <label for="gradientFieldDensity">Densidad de flechas</label>
              <input id="gradientFieldDensity" type="range" min="5" max="20" step="1" value="10" />
              <span id="gradientFieldDensityLabel">10</span>
            </div>
          </div>
          <div class="row">
            <button id="calcUseCenter" title="Fijar x₀,y₀ al centro de la caja actual">Usar centro de la caja</button>
            <small id="calcPointHint" style="margin-left: 8px; opacity: 0.8;">Vacío ⇒ se usa el centro</small>
          </div>
          <div class="grid">
            <div>
              <label for="showGradient3D">Mostrar gradiente en 3D</label>
              <input id="showGradient3D" type="checkbox" />
            </div>
            <div>
              <label for="showGradientField3D">Mostrar campo de gradiente en 3D</label>
              <input id="showGradientField3D" type="checkbox" />
            </div>
            <div>
              <label for="gradientScale">Escala flecha</label>
              <input id="gradientScale" type="range" min="0.05" max="0.5" step="0.05" value="0.2" />
              <span id="gradientScaleLabel">0.20</span>
            </div>
          </div>
          <div class="grid">
            <div>
              <label for="calcEnabled">Habilitar cálculos automáticos</label>
              <input id="calcEnabled" type="checkbox" checked />
            </div>
          </div>
<<<<<<< HEAD
          <div class="grid">
            <div>
              <label for="useSymbolicDerivatives">Usar derivadas simbólicas (si aplica)</label>
              <input id="useSymbolicDerivatives" type="checkbox" />
            </div>
            <div>
              <label for="derivHScale">Factor h derivadas</label>
              <input id="derivHScale" type="range" min="0.1" max="2.0" step="0.1" value="1" />
              <span id="derivHScaleLabel">1.00×</span>
            </div>
          </div>
          <div id="calcDomainRange" class="calc-block"></div>
          <div id="calcDerivatives" class="calc-block"></div>
=======
  <div id="calcDomainRange" class="calc-block"></div>
  <div id="calcDerivatives" class="calc-block"></div>

  <div class="row" style="margin-top:10px">
    <h3>Límites</h3>
    <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap">
      <label for="limitType">Tipo</label>
      <select id="limitType">
        <option value="x">lim x→a (con y=ȳ)</option>
        <option value="y">lim y→b (con x=x̄)</option>
        <option value="xy">lim (x,y)→(x₀,y₀)</option>
      </select>
      <label for="limitSide">Lado</label>
      <select id="limitSide">
        <option value="both">Bilateral</option>
        <option value="left">Izquierda (−)</option>
        <option value="right">Derecha (+)</option>
      </select>
      <label for="limitXTarget">a</label>
      <input id="limitXTarget" type="number" step="0.1" placeholder="x→a" style="width:100px" />
      <label for="limitYTarget">b</label>
      <input id="limitYTarget" type="number" step="0.1" placeholder="y→b" style="width:100px" />
      <button id="computeLimitsBtn">Calcular límites</button>
    </div>
    <div id="calcLimits" class="calc-block"></div>
  </div>
>>>>>>> b84ca4adfcadfa1f0dfa8a8782d467cff94045a1
          <hr />
    <h3>Integrales</h3>
          <div class="grid">
            <div>
              <label for="integralRes">Resolución integral</label>
              <input id="integralRes" type="range" min="20" max="120" step="10" value="60" />
              <span id="integralResLabel">60</span>
            </div>
            <div>
    <label for="rhoInput">Densidad ρ(x,y)</label>
    <input id="rhoInput" type="text" placeholder="1" />
    <div style="display:flex;gap:10px;align-items:center;margin-top:8px">
      <label for="volumeZ0Input">Plano z0</label>
      <input id="volumeZ0Input" type="number" step="0.1" value="0" style="width:120px" />
      <label for="volumeUseRho" style="margin-left:12px">Usar ρ como peso</label>
      <input id="volumeUseRho" type="checkbox" />
    </div>
            </div>
          </div>
          <div class="row">
            <button id="computeDoubleIntegralBtn">Calcular ∬ f(x,y) dA</button>
    <button id="computeCentroidBtn">Centro de masa (ρ)</button>
    <button id="computeVolumeBtn">Volumen bajo superficie (z=0)</button>
          </div>
          <div id="calcIntegrals" class="calc-block"></div>
          <hr />
          <h3>Optimización (Lagrange)</h3>
          <div class="grid">
            <div>
              <label for="constraintInput">Restricción g(x,y)=0</label>
              <input id="constraintInput" type="text" placeholder="x + y - 1" />
            </div>
          </div>
          <div class="row">
            <button id="solveLagrangeBtn">Resolver por multiplicadores de Lagrange</button>
          </div>
          <div id="calcOptimization" class="calc-block"></div>
        </section>
        <section class="panel">
          <h2>Ayuda Teórica</h2>
          <p>
            Esta calculadora trabaja con funciones de dos variables en la forma
            <span>z = f(x, y)</span> y visualiza tanto la superficie 3D como las
            curvas de nivel 2D dentro de los límites definidos por los ejes.
            Los resultados numéricos se calculan de manera aproximada mediante
            muestreo uniforme del dominio.
          </p>

          <h3>Función y dominio</h3>
          <p>
            El dominio usado es el rectángulo definido por <code>xmin</code>,
            <code>xmax</code>, <code>ymin</code> y <code>ymax</code>. La malla
            sobre este dominio se divide segun la <strong>Resolución</strong>,
            y en cada punto se evalúa <span>f(x,y)</span> para construir la
            superficie y las curvas de nivel.
          </p>

          <h3>Derivadas y gradiente</h3>
          <p>
            Las derivadas parciales se aproximan por diferencias finitas y el
            gradiente se muestra como
            <span>\(\nabla f(x,y) = \langle f_x(x,y),\; f_y(x,y) \rangle\)</span>.
            Su magnitud indica la rapidez de cambio y su dirección el sentido
            de mayor incremento local. La derivada direccional en una dirección
            unidad <span>\(\mathbf{u}\)</span> se calcula como
            <span>\(D_{\mathbf{u}} f = \nabla f \cdot \mathbf{u}\)</span>.
          </p>

          <h3>Curvas de nivel</h3>
          <p>
            Una curva de nivel es el conjunto de puntos
            <span>\(\{(x,y) : f(x,y) = c\}\)</span> para un valor constante
            <span>c</span>. Se dibujan múltiples valores de <span>c</span> para
            resaltar la estructura del campo escalar.
          </p>

          <h3>Superficie 3D y recorte</h3>
          <p>
            La superficie 3D se genera a partir de la malla evaluada. Las
            opciones de recorte (<code>clipToBox</code>, <code>z-clip</code>)
            permiten ocultar partes fuera de la caja o fuera del rango vertical
            especificado para mejorar la interpretación visual.
          </p>

          <h3>Integrales dobles</h3>
          <p>
            El valor aproximado de <span>\(\iint f(x,y)\, dA\)</span> se
            obtiene por suma de Riemann sobre la malla. El volumen bajo la
            superficie respecto a <span>z=0</span> y el centro de masa con
            densidad <span>\(\rho(x,y)\)</span> se calculan como:
          </p>
          <p>
            <span>
              \(V \approx \sum f(x_i,y_j)\,\Delta x\,\Delta y\),
              \quad
              \(\bar{x} = \dfrac{\iint x\,\rho\, dA}{\iint \rho\, dA}\),
              \quad
              \(\bar{y} = \dfrac{\iint y\,\rho\, dA}{\iint \rho\, dA}\).
            </span>
          </p>

          <h3>Estabilidad y buenas prácticas</h3>
          <ul>
            <li>Evita singularidades (división por cero, log de negativo, etc.).</li>
            <li>Si <span>f(x,y)</span> no está definida en algún punto, se omite.</li>
            <li>Más resolución mejora detalle pero aumenta costo de cómputo.</li>
            <li>Usa el botón "Usar centro de la caja" para fijar <span>(x₀,y₀)</span> si los campos están vacíos o inválidos.</li>
          </ul>
          <p style="opacity:0.8">
            Notación renderizada con MathJax. Todos los cálculos son
            aproximaciones numéricas basadas en muestreo.
          </p>
        </section>
      </aside>

      <main id="main">
        <div id="canvasContainer"></div>
        <div id="contourContainer"><canvas id="contourCanvas"></canvas></div>
      </main>
    </div>

    <script type="module" src="main.js"></script>
  </body>
  </html>